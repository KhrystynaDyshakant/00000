{% extends 'base.html' %}

{% block title %}–ú–æ—è –∑–∞—Ä–ø–ª–∞—Ç–∞{% endblock %}

{% block content %}
<h2><i class="bi bi-cash-stack"></i> –ú–æ—è –∑–∞—Ä–ø–ª–∞—Ç–∞ —Ç–∞ –±–æ–Ω—É—Å–∏</h2>

<div class="row mt-4">
    <!-- –ü–æ—Ç–æ—á–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞ -->
    <div class="col-md-4">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-wallet2"></i> –ü–æ—Ç–æ—á–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞</h5>
            </div>
            <div class="card-body">
                <h2 class="text-success mb-3">{{ current_salary|floatformat:2 }} –≥—Ä–Ω</h2>

                <hr>

                <h6>–¢–∏–ø —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</h6>
                <p>
                    {% if strategy.strategy_type == 'fixed' %}
                        <span class="badge bg-primary">–§—ñ–∫—Å–æ–≤–∞–Ω–∞</span>
                    {% elif strategy.strategy_type == 'bonus' %}
                        <span class="badge bg-warning text-dark">–ó –±–æ–Ω—É—Å–∞–º–∏</span>
                    {% endif %}
                </p>

                {% if strategy.strategy_type == 'fixed' %}
                    <h6>–©–æ–º—ñ—Å—è—á–Ω–∞ —Å—É–º–∞:</h6>
                    <p><strong>{{ strategy.monthly_amount|floatformat:2 }} –≥—Ä–Ω</strong></p>
                {% elif strategy.strategy_type == 'bonus' %}
                    <h6>–ë–∞–∑–æ–≤–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞:</h6>
                    <p><strong>{{ strategy.base_salary|floatformat:2 }} –≥—Ä–Ω</strong></p>

                    <h6>–í—ñ–¥—Å–æ—Ç–æ–∫ –±–æ–Ω—É—Å—É:</h6>
                    <p><strong>{{ strategy.bonus_percentage }}%</strong></p>

                    <h6>–°—É–º–∞ –±–æ–Ω—É—Å—É:</h6>
                    {% widthratio strategy.base_salary 100 strategy.bonus_percentage as bonus_calc %}
                    <p class="text-warning">
                        <strong>{{ bonus_calc|floatformat:2 }} –≥—Ä–Ω</strong>
                    </p>

                    <hr>

                    <div class="alert alert-info mb-0">
                        <small>
                            <strong>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:</strong><br>
                            {{ strategy.base_salary|floatformat:2 }} –≥—Ä–Ω (–±–∞–∑–æ–≤–∞)<br>
                            + {{ bonus_calc|floatformat:2 }} –≥—Ä–Ω ({{ strategy.bonus_percentage }}% –±–æ–Ω—É—Å)<br>
                            = <strong>{{ current_salary|floatformat:2 }} –≥—Ä–Ω</strong>
                        </small>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞—Ä–ø–ª–∞—Ç -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-calendar3"></i> –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–ø–ª–∞—Ç (–æ—Å—Ç–∞–Ω–Ω—ñ 6 –º—ñ—Å—è—Ü—ñ–≤)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>–ú—ñ—Å—è—Ü—å</th>
                                <th>–ë–∞–∑–æ–≤–∞</th>
                                {% if strategy.strategy_type == 'bonus' %}
                                <th>–ë–æ–Ω—É—Å</th>
                                {% endif %}
                                <th>–í—Å—å–æ–≥–æ</th>
                                <th>–ì–æ–¥–∏–Ω</th>
                                <th>–î–Ω—ñ–≤</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in salary_history %}
                            <tr {% if forloop.first %}class="table-active"{% endif %}>
                                <td>
                                    <strong>{{ item.month }}</strong>
                                    {% if forloop.first %}
                                        <span class="badge bg-info ms-2">–ü–æ—Ç–æ—á–Ω–∏–π</span>
                                    {% endif %}
                                </td>
                                <td>{{ item.base_salary|floatformat:2 }} –≥—Ä–Ω</td>
                                {% if strategy.strategy_type == 'bonus' %}
                                <td class="text-warning">
                                    <strong>+{{ item.bonus|floatformat:2 }} –≥—Ä–Ω</strong>
                                </td>
                                {% endif %}
                                <td class="text-success">
                                    <strong>{{ item.total|floatformat:2 }} –≥—Ä–Ω</strong>
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ item.hours_worked }} –≥–æ–¥</span>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{{ item.days_worked }} –¥–Ω</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <th colspan="{% if strategy.strategy_type == 'bonus' %}3{% else %}2{% endif %}">
                                    <strong>–†–∞–∑–æ–º –∑–∞ 6 –º—ñ—Å—è—Ü—ñ–≤:</strong>
                                </th>
                                <th class="text-primary">
                                    {% widthratio current_salary 1 6 as total_6months %}
                                    <strong>{{ total_6months|floatformat:2 }} –≥—Ä–Ω</strong>
                                </th>
                                <th colspan="2"></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mt-3">
            <div class="col-md-4">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <h6><i class="bi bi-calculator"></i> –°–µ—Ä–µ–¥–Ω—è –∑–∞—Ä–ø–ª–∞—Ç–∞</h6>
                        <h4 class="text-primary mb-0">
                            {{ current_salary|floatformat:2 }} –≥—Ä–Ω
                        </h4>
                        <small class="text-muted">–∑–∞ –º—ñ—Å—è—Ü—å</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <h6><i class="bi bi-clock-history"></i> –¶—å–æ–≥–æ –º—ñ—Å—è—Ü—è</h6>
                        <h4 class="text-info mb-0">
                            {{ salary_history.0.hours_worked }} –≥–æ–¥
                        </h4>
                        <small class="text-muted">–≤—ñ–¥–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-light">
                    <div class="card-body text-center">
                        <h6><i class="bi bi-calendar-check"></i> –†–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤</h6>
                        <h4 class="text-success mb-0">
                            {{ salary_history.0.days_worked }}
                        </h4>
                        <small class="text-muted">—Ü—å–æ–≥–æ –º—ñ—Å—è—Ü—è</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> –Ø–∫ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –º–æ—è –∑–∞—Ä–ø–ª–∞—Ç–∞?</h5>
            </div>
            <div class="card-body">
                {% if strategy.strategy_type == 'fixed' %}
                    <p class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        –£ –≤–∞—Å <strong>—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞</strong> - {{ strategy.monthly_amount|floatformat:2 }} –≥—Ä–Ω —â–æ–º—ñ—Å—è—Ü—è
                    </p>
                    <p class="mb-2">
                        <i class="bi bi-info-circle text-primary"></i>
                        –ó–∞—Ä–ø–ª–∞—Ç–∞ –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–∏—Ö –≥–æ–¥–∏–Ω
                    </p>
                    <p class="mb-0">
                        <i class="bi bi-calendar-event text-info"></i>
                        –í–∏–ø–ª–∞—Ç–∞ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —â–æ–º—ñ—Å—è—Ü—è –≤ –æ–¥–∏–Ω —ñ —Ç–æ–π —Å–∞–º–∏–π –¥–µ–Ω—å
                    </p>
                {% elif strategy.strategy_type == 'bonus' %}
                    <p class="mb-2">
                        <i class="bi bi-piggy-bank text-warning"></i>
                        –£ –≤–∞—Å –∑–∞—Ä–ø–ª–∞—Ç–∞ <strong>–∑ –±–æ–Ω—É—Å–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é</strong>
                    </p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="alert alert-light border">
                                <h6 class="text-primary">üìä –§–æ—Ä–º—É–ª–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</h6>
                                <p class="mb-1"><strong>–ë–∞–∑–æ–≤–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞:</strong> {{ strategy.base_salary|floatformat:2 }} –≥—Ä–Ω</p>
                                <p class="mb-1"><strong>–ë–æ–Ω—É—Å ({{ strategy.bonus_percentage }}%):</strong>
                                    {% widthratio strategy.base_salary 100 strategy.bonus_percentage as bonus_amount %}
                                    {{ bonus_amount|floatformat:2 }} –≥—Ä–Ω
                                </p>
                                <hr class="my-2">
                                <p class="mb-0"><strong>–†–∞–∑–æ–º:</strong> <span class="text-success">{{ current_salary|floatformat:2 }} –≥—Ä–Ω</span></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-light border">
                                <h6 class="text-info">üí° –Ø–∫ –∑–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ—Ö—ñ–¥?</h6>
                                <ul class="mb-0">
                                    <li>–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –≤—ñ–¥—Å–æ—Ç–∫–∞ –±–æ–Ω—É—Å—É</li>
                                    <li>–ó–±—ñ–ª—å—à–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –∑–∞—Ä–ø–ª–∞—Ç–∏</li>
                                    <li>–î–æ—Å—è–≥–Ω–µ–Ω–Ω—è KPI –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'employee_dashboard' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –Ω–∞ –ø–∞–Ω–µ–ª—å
    </a>
</div>
{% endblock %}